{% set vuln_view = vulnerability_details.vulnerability_view %}

{% set commit_link = vulnerability_details.commit_link %}
{% set cve_id = vulnerability_details.cve_id %}
{% set vuln_id = vulnerability_details.id %}
{% set commit_hash = vulnerability_details.commit_hash %}
{% set repo_url = vulnerability_details.repo_url %}

<div class="row">
  <div class="col-md-6">
    <div class="card">
      <div class="card-body">
        {% if vulnerability_details.vulnerability and vuln_id %}
          <div class="flex-md-row mb-4 box-shadow h-md-250">
            <h5 class="mb-0 d-inline">Vulnerability Info</h5>
            <span class="d-inline-block mb-1 text-muted">
            <a href="{{ url_for('vuln.create_vuln', vuln_id=vuln_id) }}">(Edit Entry)</a>
          </span>
            <span class="d-inline-block mb-1 text-muted">

            <a href="{{ url_for('vuln.vuln_editor', vuln_id=vuln_id) }}">
              <button type="button" class="btn btn-primary">Annotate</button>
            </a>
          </span>
          </div>

          {% if vuln_view.cve_id %}<p class="text-info"><b>{{ vuln_view.cve_id }}</b></p>
          {% endif %}

          <p>Description:<br/>{% if vuln_view.comment %}
            <b>{{ vuln_view.comment }}</b>{% else %}-{% endif %}</p>

          {% if vuln_view.additional_resources %}
            <h5>Additional Resources</h5>
            <div class="list-group">
              {% for resource_link in vuln_view.additional_resources %}
                <a href="#" class="list-group-item">{{ resource_link.link }}</a>
              {% endfor %}
            </div>
          {% endif %}


          <b>Associated Patches</b>
          <div class="list-group">
            {% for commit_link in vuln_view.commits %}
              <div class="list-group-item">
                <a href="{{ commit_link.commit_link }}"
                   target="_blank">{{ commit_link.commit_link }}</a>
              </div>
            {% endfor %}
          </div>
          <br/>

        {% else %}
        <form action="{{ url_for('vuln.create_vuln', vuln_id=None) }}" method="post">
            <input type="hidden" name="id" value="{{vuln_id}}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
          {% if commit_link %}
          Commit Link:
          <h5>
            <a href="{{ commit_link }}" target="_blank">{{ commit_link }}</a>
          </h5>
          <input type="hidden" name="commits-0-commit_link" value="{{ commit_link }}">
          {% endif %}
          {% if repo_url and commit_hash %}
          Repository:
          <h5>{{ repo_url }}</h5>
          Commit:
          <h5>{{ commit_hash }}</h5>
          <input type="hidden" name="commits-0-repo_url" value="{{ repo_url }}">
          <input type="hidden" name="commits-0-commit_hash" value="{{ commit_hash }}">
          {% else %}
          <h5>{{ vuln_id }}</h5>
          {% endif %}
            <div class="alert alert-primary" role="alert">
            No entry for this data found.
            <button type="submit" class="btn btn-link">Create new entry</button>
            </div>
          </form>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card">
      {% if vulnerability_details.nvd_data is not none %}
      {% set nvd_data = vulnerability_details.nvd_data %}
      <div class="card-body d-flex flex-column align-items-start"
           style="{% if vulnerability_details.vulnerability and vulnerability_details.hasCustomData() %}max-height: 20em;{% endif %} overflow:auto">
        {% include 'nvd_view.html' %}
      </div>
      {% endif %}
    </div>
  </div>
</div>
